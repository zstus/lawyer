{% extends "base.html" %}

{% block title %}ì•½ì •ì„œ ìƒì„¸ - ëŒ€ì¶œì•½ì •ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">ğŸ  í™ˆ</a> &gt; <span id="agreementName">ì•½ì •ì„œ</span>
</div>

<div class="page-header" id="headerSection">
    <h1 id="agreementTitle">ë¡œë”© ì¤‘...</h1>
    <p class="subtitle" id="agreementMeta"></p>
</div>

<!-- ì¡° ëª©ë¡ ì„¹ì…˜ -->
<section class="articles-section">
    <h2>ğŸ“‘ ì¡°(Article) ëª©ë¡</h2>
    <p class="section-description">ì¡°ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì¡°ì˜ í•­ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div id="articlesList" class="articles-list">
        <div class="loading">ë¡œë”© ì¤‘...</div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const agreementId = {{ agreement_id }};
    const articlesList = document.getElementById('articlesList');

    async function loadAgreement() {
        try {
            const response = await fetch(`/api/agreements/${agreementId}`);

            if (!response.ok) {
                if (response.status === 404) {
                    articlesList.innerHTML = '<p class="error-message">ì•½ì •ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                throw new Error('Failed to load');
            }

            const agreement = await response.json();

            // í—¤ë” ì—…ë°ì´íŠ¸
            document.getElementById('agreementName').textContent = agreement.name;
            document.getElementById('agreementTitle').textContent = agreement.name;
            document.getElementById('agreementMeta').innerHTML = `
                ğŸ“„ ${escapeHtml(agreement.file_name)} |
                ğŸ“‘ ì´ ${agreement.article_count}ê°œ ì¡°í•­ |
                ğŸ• ${formatDate(agreement.created_at)}
            `;
            document.title = `${agreement.name} - ëŒ€ì¶œì•½ì •ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ`;

            // ì¡° ëª©ë¡ í‘œì‹œ
            if (agreement.articles.length === 0) {
                articlesList.innerHTML = '<p class="empty-message">ì¡°í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            articlesList.innerHTML = agreement.articles.map(article => `
                <div class="article-card card" onclick="location.href='/agreement/${agreementId}/article/${article.id}'">
                    <div class="article-number">ì œ ${article.article_number_display} ì¡°</div>
                    <div class="article-info">
                        <h3>${escapeHtml(article.title)}</h3>
                        <p class="meta">
                            <span>ğŸ“ ${article.clause_count}ê°œ í•­</span>
                        </p>
                    </div>
                    <div class="article-arrow">â–¶</div>
                </div>
            `).join('');

        } catch (error) {
            articlesList.innerHTML = '<p class="error-message">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('ko-KR');
    }

    loadAgreement();
});
</script>
{% endblock %}
